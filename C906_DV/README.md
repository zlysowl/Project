# C906_DV
# 完成玄铁C906 CPU验证环境的搭建

放弃Wujian100 SoC平台，直接基于 **C906核心** 和 **RISCV-DV** 搭建一个纯净、专业的UVM验证环境，这是一个极具挑战性但也绝对会有巨大收获的项目。

- **C906**：一款高性能、有序发射、支持MMU的64位RISC-V处理器，远比E902复杂，能让你练习到真实CPU验证中的各种场景。
- **RISCV-DV**：Google开发的行业标准RISC-V指令生成器，是验证CPU合规性的核心工具。
- **纯UVM环境**：让你完全掌控验证环境的架构，避免SoC平台中各种外设和固定集成方式的干扰。

这是一个相当复杂的工程，我会为你规划一个详细的实现路径和架构建议。

---
### 项目架构规划

你设想的环境核心架构如下图所示，这清晰地勾勒出了数据流和关键组件：
![[deepseek_mermaid_20250913_a9e387.png|350]]
如上图所示，整个流程的核心是：**用RISCV-DV生成随机程序，编译后通过UVM环境加载到内存模型中，C906执行后，通过监测总线活动来检查其行为是否正确**。

---

### 实现步骤与关键技术点

#### 第一阶段：环境搭建与组件开发

1. **获取并集成C906 RTL**：
	- [x] 从阿里平头哥开源平台获取C906的RTL代码。
	- [x] 编写一个**最小化的tb顶层包装模块**。这个模块只包含C906 
2. **搭建UVM框架**：
	- [x] 搭建**UVM环境**，创建基础的`uvm_test`、`uvm_env`，例化时钟和复位，sanity case可以给出复位后时钟，复位后往外部取指令。
	- [ ] 调用svt在上面新增**AXI slave agent的环境**，集成
>     axi svt的选择，一共有下图这么多种
    ![[Pasted image 20250924213217.png|164]]
    ![[Pasted image 20250924214152.png|550]]
    选择完整的slave
3. **集成内存模型**：
    - 使用`uvm_mem`或自己编写一个支持后台加载的Memory Model。
	- [ ] 新增一个**UVM控制下的Memory行为模型**。
    - **关键功能**：必须支持通过`$readmemh`或类似的SystemVerilog任务，在仿真开始时将RISCV-DV生成的二进制测试程序预加载到内存的特定地址（例如复位向量地址）。
        

#### 第二阶段：集成RISCV-DV与参考模型

4. **连接RISCV-DV**：
    
    - RISCV-DV通常输出的是汇编程序（.S文件）。
        
    - **流程**：编写脚本，自动调用**RISC-V GNU工具链** 将.S文件汇编和链接成二进制文件（.bin/.hex）。
        
    - 将这个二进制文件作为验证测试用例的输入，通过上述内存模型加载。
        
5. **构建黄金参考模型**：
    
    - 这是验证环境的“大脑”。Monitor抓到总线的写操作（比如寄存器回写、内存存储），需要有一个标准来判断这些操作是否正确。
        
    - **方案选择**：
        
        - **高效方案**：直接使用**Spike（RISC-V ISA模拟器）**。在运行UVM仿真前，先用Spike执行同样的测试程序，并将其所有的**寄存器状态变更和内存存储记录**到一个日志文件中。UVM的Scoreboard读取这个日志文件，并与Monitor抓到的结果进行比对。
            
        - **灵活方案**：在Scoreboard中嵌入一个简单的**C++指令解释模型**（通过DPI-C调用）。这更灵活，但开发难度更大。
            

#### 第三阶段：实现自动化与覆盖率收集

6. **测试流程自动化**：
    
    - 编写Makefile或Python脚本，将整个过程自动化：生成种子 -> RISCV-DV生成汇编 -> GNU编译 -> 启动仿真（带种子） -> 结果比对。
        
7. **覆盖率收集**：
    
    - 在仿真中收集代码覆盖率和功能覆盖率。
        
    - **功能覆盖率**点需要你根据C906的特性自己定义，例如：
        
        - 哪些指令被覆盖了？
            
        - 是否发生了中断/异常？
            
        - 是否进入了不同的处理器模式？
            
        - 是否测试了MMU的地址转换？
            

---

### 挑战与注意事项

- **复杂度**：C906是一个完整的CPU，调试一个失败的测试用例会非常困难。你需要熟练掌握波形调试技巧，并可能需要C906的设计文档来理解其预期行为。
    
- **工具依赖**：你需要配置好RISC-V GNU工具链、Spike以及EDA工具（如VCS、Verilator）。
    
- **初始化**：确保CPU的复位流程、PC的初始值、内存的初始化地址都与你的测试程序匹配。
    
- **异步中断**：如何将UVM环境中产生的虚拟中断信号安全地传递给C906，也是一个需要设计的点。
    

### 总结

你这个想法**非常出色**，是成为一名顶尖CPU验证工程师的绝佳实践。虽然过程会充满挑战，但每解决一个问题，你都会对CPU验证有更深的理解。

**给你的建议**：将这个大项目拆解成无数个小任务，逐个攻克。例如：

1. **第一周**：成功编译C906 RTL，并在一个简单的testbench中看到它开始取指。
    
2. **第二周**：搭建好UVM环境，能让总线Agent向内存写数据。
    
3. **第三周**：成功将一段手写汇编程序加载到内存并让C906执行。
    
4. **第四周**：Monitor能抓到C906执行后的数据写入。  
    ... 以此类推。